{% extends 'base.html' %}

{% block content %}

    <h1 style="text-align: center">Checkout</h1>
    <div class="container">
        <div class="row">
            <div class="col-lg">
                <br>
                <div class="card card-body border-0">
                    <h4><span style="color: black">Crypto Currency : </span>{{ selected_currency }}</h4>
                    <h4><span style="color: black">Total Price:</span>{{ totalPrice_str }}</h4>
                    <hr>
                    <div id="paypal-button" style="height: 200px"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="paypal-button"></div>
    <p>{{ total_price }}</p>

    <script src="https://www.paypalobjects.com/api/checkout.js"></script>
    <script>
        paypal.Button.render({
            // Configure environment
            env: 'sandbox',
            client: {
                sandbox: 'demo_sandbox_client_id',
                production: 'demo_production_client_id'
            },
            // Customize button (optional)
            locale: 'en_US',
            style: {
                color: 'gold',
                shape: 'rect',
                layout: 'vertical',
                label: 'paypal',
            },

            // Enable Pay Now checkout flow (optional)
            commit: true,

            // Set up a payment
            payment: function (data, actions) {
                return actions.payment.create({
                    transactions: [{
                        amount: {
                            total: '{{ totalPrice }}',
                            currency: 'USD'
                        }
                    }]
                });
            },
            // Execute the payment
            onAuthorize: function (data, actions) {
                return actions.payment.execute().then(function () {
                    // Show a confirmation message to the buyer

                    window.alert('Thank you for your purchase!');
                    window.location.href = "{% url 'CryptoApp:index' %}"
                });
            }
        }, '#paypal-button');

    </script>


{% endblock %}
